<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本地回调测试</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #e2e3e5; color: #383d41; }
    </style>
</head>
<body>
    <h1>本地回调测试</h1>
    
    <div class="test-section">
        <h3>测试本地回调处理</h3>
        <p>这个页面模拟支付平台向您的回调地址发送请求的过程。</p>
        <button onclick="simulateCallback()">模拟支付回调</button>
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        function simulateCallback() {
            const payId = 'TEST_ORDER_' + Date.now();
            const param = '测试商品';
            const type = '1';
            const price = '0.01';
            const reallyPrice = '0.01';
            const appSecret = 'f659709e38ab01a9d77e52cdcda9a914';

            // 计算签名
            const signString = payId + param + type + price + reallyPrice + appSecret;
            const signature = CryptoJS.MD5(signString).toString();

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h4>模拟支付回调数据：</h4>
                <p><strong>订单号：</strong>${payId}</p>
                <p><strong>商品描述：</strong>${param}</p>
                <p><strong>支付方式：</strong>${type === '1' ? '微信支付' : '支付宝支付'}</p>
                <p><strong>订单金额：</strong>¥${price}</p>
                <p><strong>实际支付金额：</strong>¥${reallyPrice}</p>
                <p><strong>签名字符串：</strong>${signString}</p>
                <p><strong>计算签名：</strong>${signature}</p>
                <br>
                <h4>回调URL示例：</h4>
                <p><strong>异步回调：</strong><br>
                <code>https://your-site.netlify.app/.netlify/functions/payment-callback?payId=${payId}&param=${param}&type=${type}&price=${price}&reallyPrice=${reallyPrice}&sign=${signature}</code></p>
                <br>
                <p><strong>同步回调：</strong><br>
                <code>https://your-site.netlify.app/payment/callback?type=return&payId=${payId}</code></p>
                <br>
                <p><strong>测试说明：</strong></p>
                <ul>
                    <li>将上述URL中的 "your-site" 替换为您的实际Netlify域名</li>
                    <li>在浏览器中打开异步回调URL测试服务器响应</li>
                    <li>在浏览器中打开同步回调URL测试用户跳转</li>
                    <li>检查浏览器开发者工具的Network标签页查看响应</li>
                </ul>
            `;
            resultDiv.className = 'result info';
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>
