<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•å›è°ƒå¤„ç†å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #e2e3e5; color: #383d41; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç®€å•å›è°ƒå¤„ç†å™¨</h1>
    
    <div id="callbackResult" class="status info">
        <h3>ç­‰å¾…å›è°ƒæ•°æ®...</h3>
        <p>è¿™ä¸ªé¡µé¢å¯ä»¥ç›´æ¥å¤„ç†è“é²¸æ”¯ä»˜çš„å›è°ƒè¯·æ±‚</p>
    </div>

    <div id="callbackLog" class="log" style="display: none;">
        å›è°ƒæ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
    </div>

    <script>
        const appSecret = 'f659709e38ab01a9d77e52cdcda9a914';

        function handleCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const payId = urlParams.get('payId');
            const param = urlParams.get('param');
            const type = urlParams.get('type');
            const price = urlParams.get('price');
            const reallyPrice = urlParams.get('reallyPrice');
            const sign = urlParams.get('sign');

            if (payId) {
                console.log('æ”¶åˆ°å›è°ƒå‚æ•°:', { payId, param, type, price, reallyPrice, sign });
                
                // éªŒè¯ç­¾å
                const signString = `${payId}${param}${type}${price}${reallyPrice}${appSecret}`;
                const calculatedSign = CryptoJS.MD5(signString).toString();
                
                const isValid = calculatedSign === sign;
                
                const resultDiv = document.getElementById('callbackResult');
                const logDiv = document.getElementById('callbackLog');
                
                if (isValid) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>âœ… æ”¯ä»˜å›è°ƒéªŒè¯æˆåŠŸï¼</h3>
                            <p><strong>è®¢å•å·ï¼š</strong>${payId}</p>
                            <p><strong>å•†å“æè¿°ï¼š</strong>${param}</p>
                            <p><strong>æ”¯ä»˜æ–¹å¼ï¼š</strong>${type === '1' ? 'å¾®ä¿¡æ”¯ä»˜' : 'æ”¯ä»˜å®æ”¯ä»˜'}</p>
                            <p><strong>è®¢å•é‡‘é¢ï¼š</strong>Â¥${price}</p>
                            <p><strong>å®é™…æ”¯ä»˜é‡‘é¢ï¼š</strong>Â¥${reallyPrice}</p>
                            <p><strong>éªŒè¯æ—¶é—´ï¼š</strong>${new Date().toLocaleString()}</p>
                        </div>
                    `;
                    
                    logDiv.innerHTML = `
[${new Date().toLocaleString()}] æ”¯ä»˜å›è°ƒå¤„ç†æˆåŠŸ
è®¢å•å·: ${payId}
å•†å“æè¿°: ${param}
æ”¯ä»˜æ–¹å¼: ${type === '1' ? 'å¾®ä¿¡æ”¯ä»˜' : 'æ”¯ä»˜å®æ”¯ä»˜'}
è®¢å•é‡‘é¢: Â¥${price}
å®é™…æ”¯ä»˜é‡‘é¢: Â¥${reallyPrice}
ç­¾åå­—ç¬¦ä¸²: ${signString}
è®¡ç®—ç­¾å: ${calculatedSign}
æ¥æ”¶ç­¾å: ${sign}
ç­¾åéªŒè¯: é€šè¿‡
å¤„ç†ç»“æœ: æˆåŠŸ
                    `;
                    logDiv.style.display = 'block';
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>âŒ æ”¯ä»˜å›è°ƒéªŒè¯å¤±è´¥ï¼</h3>
                            <p><strong>è®¢å•å·ï¼š</strong>${payId}</p>
                            <p><strong>é”™è¯¯åŸå› ï¼š</strong>ç­¾åéªŒè¯å¤±è´¥</p>
                            <p><strong>è®¡ç®—ç­¾åï¼š</strong>${calculatedSign}</p>
                            <p><strong>æ¥æ”¶ç­¾åï¼š</strong>${sign}</p>
                        </div>
                    `;
                    
                    logDiv.innerHTML = `
[${new Date().toLocaleString()}] æ”¯ä»˜å›è°ƒå¤„ç†å¤±è´¥
è®¢å•å·: ${payId}
å•†å“æè¿°: ${param}
æ”¯ä»˜æ–¹å¼: ${type === '1' ? 'å¾®ä¿¡æ”¯ä»˜' : 'æ”¯ä»˜å®æ”¯ä»˜'}
è®¢å•é‡‘é¢: Â¥${price}
å®é™…æ”¯ä»˜é‡‘é¢: Â¥${reallyPrice}
ç­¾åå­—ç¬¦ä¸²: ${signString}
è®¡ç®—ç­¾å: ${calculatedSign}
æ¥æ”¶ç­¾å: ${sign}
ç­¾åéªŒè¯: å¤±è´¥
å¤„ç†ç»“æœ: å¤±è´¥
                    `;
                    logDiv.style.display = 'block';
                }
            } else {
                document.getElementById('callbackResult').innerHTML = `
                    <div class="info">
                        <h3>ğŸ“‹ ç®€å•å›è°ƒå¤„ç†å™¨</h3>
                        <p>è¿™ä¸ªé¡µé¢å¯ä»¥å¤„ç†è“é²¸æ”¯ä»˜çš„å›è°ƒè¯·æ±‚</p>
                        <p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
                        <ol>
                            <li>åœ¨è“é²¸æ”¯ä»˜åå°è®¾ç½®å›è°ƒåœ°å€ä¸ºï¼š<code>https://poetic-macaron-d0fbdb.netlify.app/simple-callback.html</code></li>
                            <li>æ”¯ä»˜å®Œæˆåä¼šè‡ªåŠ¨è·³è½¬åˆ°æ­¤é¡µé¢</li>
                            <li>é¡µé¢ä¼šè‡ªåŠ¨éªŒè¯ç­¾åå¹¶æ˜¾ç¤ºç»“æœ</li>
                        </ol>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶å¤„ç†å›è°ƒ
        window.onload = handleCallback;
    </script>
</body>
</html>
